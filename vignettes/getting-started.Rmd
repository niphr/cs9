---
title: "Getting Started with CS9"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with CS9}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
editor_options:
  chunk_output_type: console
---





## What is CS9?

Core Surveillance 9 (CS9) is a comprehensive R framework designed for building real-time disease surveillance systems. It provides the infrastructure needed for:

- **Real-time data processing**: Automated pipelines for surveillance data
- **Database-driven workflows**: Robust data storage and retrieval
- **Task scheduling**: Parallel processing and workflow orchestration  
- **Epidemiological analysis**: Built-in support for surveillance concepts
- **Production deployment**: Docker-ready infrastructure for operational systems

CS9 is particularly suited for public health organizations, epidemiologists, and researchers who need to process surveillance data systematically and reliably.

## When Should You Use CS9?

CS9 is ideal when you need to:

- Process surveillance data on a regular schedule (daily, weekly)
- Maintain historical data with proper database management
- Run complex analysis pipelines with dependencies between tasks
- Deploy surveillance systems in production environments
- Handle multiple data sources and analysis outputs
- Ensure data validation and quality control

## Key Concepts

### Surveillance System Architecture

CS9 organizes surveillance work around these core concepts:

**Tasks**: The fundamental unit of work - things like "download weather data", "calculate disease trends", or "generate reports"

**Plans**: Data processing units within tasks - typically organized by time periods, geographic areas, or data subsets  

**Analyses**: Individual computations within plans - the actual analytical work performed on the data

**Schemas**: Database table definitions with validation rules and access control

### Example Workflow

A typical CS9 surveillance system might include:

1. **Data Import Task**: Download data from external APIs or files
2. **Data Cleaning Task**: Validate, standardize, and quality-check incoming data  
3. **Analysis Task**: Calculate surveillance indicators, trends, or alerts
4. **Reporting Task**: Generate outputs like Excel files, plots, or automated reports
5. **Delivery Task**: Send results via email, upload to websites, or trigger alerts

## Getting Started: The cs9example Template

The best way to start with CS9 is to use the [cs9example](https://github.com/csids/cs9example) repository as a template. This provides a complete, working surveillance system that you can customize.

### cs9example Structure


```
#> https://github.com/csids/cs9example/blob/main/R/00_env_and_namespace.R#L1-L30
#> 
#>  1 | # ******************************************************************************
#>  2 | # ******************************************************************************
#>  3 | #
#>  4 | # 00_env_and_namespace.R
#>  5 | #
#>  6 | # PURPOSE 1:
#>  7 | #   Use roxygen2 to import ggplot2, data.table, %>%, and %<>% into the namespace,
#>  8 | #   because these are the most commonly used packages/functions.
#>  9 | #
#> 10 | # PURPOSE 2:
#> 11 | #   Declaration of environments that can be used globally.
#> 12 | #
#> 13 | # PURPOSE 3:
#> 14 | #   Fix issues/integration with other packages.
#> 15 | #
#> 16 | #   Most notably is the issue with rmarkdown, where an error is thrown when
#> 17 | #   rendering multiple rmarkdown documents in parallel.
#> 18 | #
#> 19 | # ******************************************************************************
#> 20 | # ******************************************************************************
#> 21 | 
#> 22 | #' @import ggplot2
#> 23 | #' @import data.table
#> 24 | #' @importFrom magrittr %>% %<>%
#> 25 | 1
#> 26 | 
#> 27 | #' Declaration of environments that can be used globally
#> 28 | #' @export global
#> 29 | global <- new.env()
#> 30 |
```

The cs9example demonstrates the standard file organization:

- **00_env_and_namespace.R**: Package setup and global environment
- **01_definitions.R**: Global definitions (borders, age groups, etc.)  
- **02_surveillance_systems.R**: Initialize the surveillance system
- **03_tables.R**: Database table definitions
- **04_tasks.R**: Task configurations
- **10_onLoad.R**: Package loading sequence

### Example Task Implementation

Here's how a surveillance task is structured in cs9example:


```
#> https://github.com/csids/cs9example/blob/main/R/04_tasks.R#L20-L45
#> 
#> 20 |   # cs9::run_task_sequentially_as_rstudio_job_using_load_all("weather_download_and_import_rawdata")
#> 21 |   global$ss$add_task(
#> 22 |     name_grouping = "weather",
#> 23 |     name_action = "download_and_import_rawdata",
#> 24 |     name_variant = NULL,
#> 25 |     cores = 1,
#> 26 |     plan_analysis_fn_name = NULL,
#> 27 |     for_each_plan = plnr::expand_list(
#> 28 |       location_code = unique(csmaps::nor_municip_map_b2024_default_dt$location_code)
#> 29 |     ),
#> 30 |     for_each_analysis = NULL,
#> 31 |     universal_argset = NULL,
#> 32 |     upsert_at_end_of_each_plan = FALSE,
#> 33 |     insert_at_end_of_each_plan = FALSE,
#> 34 |     action_fn_name = "cs9example::weather_download_and_import_rawdata_action",
#> 35 |     data_selector_fn_name = "cs9example::weather_download_and_import_rawdata_data_selector",
#> 36 |     tables = list(
#> 37 |       # input
#> 38 | 
#> 39 |       # output
#> 40 |       "anon_example_weather_rawdata" = global$ss$tables$anon_example_weather_rawdata
#> 41 |     )
#> 42 |   )
#> 43 | 
#> 44 |   ## > weather_clean_data ----
#> 45 |   # cs9::run_task_sequentially_as_rstudio_job_using_load_all("weather_clean_data")
```

Each task includes:

- **Task configuration**: Name, parallelization, arguments
- **Data selector function**: Extracts data needed for the task
- **Action function**: Performs the actual analysis work
- **Database tables**: Input and output data storage

## Infrastructure Requirements

CS9 requires database infrastructure to function. After installing from CRAN, you'll need to:

1. **Set up a PostgreSQL database** (recommended) or MariaDB
2. **Configure environment variables** for database connection
3. **Use Docker for deployment** (recommended for production)

Without database setup, CS9 loads with limited functionality. You can check what's needed with:

```r
cs9::check_environment_setup()
```

## Next Steps

1. **Evaluate CS9**: Install from CRAN and explore the documentation
2. **Review cs9example**: Study the complete example implementation  
3. **Set up infrastructure**: Configure database and environment
4. **Clone cs9example**: Use it as a template for your surveillance system
5. **Customize**: Modify the example for your specific surveillance needs

For detailed infrastructure setup, see the [Installation](installation.html) vignette.

For learning how to create tasks, see the [Creating a Task](creating-a-task.html) vignette.

For understanding the file organization, see the [File Layout](file-layout.html) vignette.

## Resources

- **cs9 Package**: Available on CRAN and at https://github.com/csids/cs9
- **cs9example Template**: https://github.com/csids/cs9example  
- **Documentation**: https://www.csids.no/cs9/
- **Docker Examples**: https://github.com/csids/docker-examples-csids

CS9 is part of the [csverse](https://www.csids.no/packages.html) - a collection of R packages for surveillance and epidemiological analysis.
